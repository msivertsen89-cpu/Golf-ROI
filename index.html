<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Golf ROI ‚Äì Treningsanalyse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
h1 { margin-top:20px; }
.card {
  background:white;
  padding:14px;
  margin-bottom:12px;
  border-radius:8px;
}
.accordion-header {
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.accordion-content {
  display:none;
  margin-top:12px;
}
.grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(170px,1fr));
  gap:12px;
}
.field label {
  font-size:13px;
  color:#333;
}
.field .hint {
  font-size:12px;
  color:#777;
}
input[type=number], select {
  width:100%;
  padding:6px;
}
.good { color:green; }
.bad { color:#c62828; }
.focus { color:#ef6c00; font-weight:bold; }
.tip {
  background:#f1f8e9;
  padding:10px;
  border-radius:6px;
  margin-top:8px;
}
.progress {
  font-size:14px;
  margin-top:6px;
}
button {
  padding:6px 10px;
  cursor:pointer;
  margin:4px 4px 0 0;
}
.small { font-size:13px; color:#555; }

/* Modal */
.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal {
  background:white;
  padding:20px;
  border-radius:8px;
  max-width:420px;
  width:100%;
}
</style>
</head>

<body>

<!-- ONBOARDING -->
<div id="onboarding" class="overlay" style="display:none;">
  <div class="modal">
    <h2 id="onboardTitle"></h2>
    <p id="onboardText"></p>
    <button onclick="nextOnboard()">Neste</button>
  </div>
</div>

<!-- PROFIL -->
<div id="profileModal" class="overlay" style="display:none;">
  <div class="modal">
    <h2>Profil</h2>

    <label>Handicap</label>
    <select id="hcpInput">
      <option value="">Vel</option>
      <option>0‚Äì9</option>
      <option>10‚Äì19</option>
      <option>20‚Äì29</option>
      <option>30‚Äì54</option>
    </select>

    <br><br>

    <label>Kva √∏nskjer du √• prioritere i treninga?</label>
    <select id="goalInput">
      <option value="">Vel</option>
      <option>Presisjon</option>
      <option>Lengde</option>
      <option>Stabilitet</option>
    </select>
    <p class="small">Brukast n√•r fleire omr√•de er like svake.</p>

    <button onclick="saveProfile()">Lagre</button>
  </div>
</div>

<h1>üèåÔ∏è Golf ROI ‚Äì Treningsanalyse</h1>

<div class="card">
  <button onclick="startOnboarding()">‚ÑπÔ∏è Kom i gang</button>
  <button onclick="openProfile()">‚öôÔ∏è Profil</button>
</div>

<div id="clubs"></div>

<script>
/* ===============================
   KONFIG
=============================== */

const STORAGE_KEY = "roi_state_v1_3_2";
const PROFILE_KEY = "roi_profile_v1_3_2";
const ONBOARD_KEY = "roi_onboarded_v1";

const CLUB_MODEL = {
  "Driver":"wood","5W":"wood",
  "5i":"iron","6i":"iron","7i":"iron","8i":"iron","9i":"iron",
  "PW":"wedge","50¬∞":"wedge","56¬∞":"wedge","60¬∞":"wedge"
};

const PGA = {
  wood:{ side:12, cons:12, smash:1.45 },
  iron:{ side:9, cons:8, smash:1.32 },
  wedge:{ side:7, cons:6, smash:1.25 }
};

/* ===============================
   STATE
=============================== */

let clubStates = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let profile = JSON.parse(localStorage.getItem(PROFILE_KEY)) || {};

/* ===============================
   ONBOARDING
=============================== */

const onboardSteps = [
  {title:"Dette er ein trenar", text:"Appen gir deg konkrete treningsr√•d per k√∏lle ‚Äì ikkje berre tal."},
  {title:"Dette treng du", text:"Legg inn grove snitt og estimat fr√• range eller simulator. Start med 2‚Äì3 k√∏ller ‚Äì det er meir enn godt nok."},
  {title:"Dette f√•r du", text:"Du f√•r fokus og √∏vingar som faktisk gjer treninga meir m√•lretta."}
];
let onboardIndex = 0;

if(!localStorage.getItem(ONBOARD_KEY)) startOnboarding();

function startOnboarding(){
  onboardIndex = 0;
  document.getElementById("onboarding").style.display="flex";
  renderOnboard();
}
function nextOnboard(){
  onboardIndex++;
  if(onboardIndex>=onboardSteps.length){
    document.getElementById("onboarding").style.display="none";
    localStorage.setItem(ONBOARD_KEY,"true");
    return;
  }
  renderOnboard();
}
function renderOnboard(){
  document.getElementById("onboardTitle").innerText = onboardSteps[onboardIndex].title;
  document.getElementById("onboardText").innerText = onboardSteps[onboardIndex].text;
}

/* ===============================
   PROFIL
=============================== */

function openProfile(){
  document.getElementById("hcpInput").value = profile.hcp || "";
  document.getElementById("goalInput").value = profile.goal || "";
  document.getElementById("profileModal").style.display="flex";
}
function saveProfile(){
  profile.hcp = document.getElementById("hcpInput").value;
  profile.goal = document.getElementById("goalInput").value;
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
  document.getElementById("profileModal").style.display="none";
}

/* ===============================
   INIT K√òLLER
=============================== */

const container = document.getElementById("clubs");

for(const c in CLUB_MODEL){
  clubStates[c] ||= { baseline:null, previous:null, current:{} };

  container.innerHTML += `
    <div class="card">
      <div class="accordion-header" onclick="toggle('${c}')">
        ${c}<span id="icon-${c}">‚ñ∂</span>
      </div>

      <div class="accordion-content" id="content-${c}">
        <div class="grid">
          ${field(c,"side","Side-consistency (m)","Kor stort side-til-side utslag du har. Basert p√• ca. 10‚Äì20 slag.")}
          ${field(c,"cons","Length consistency (m)","Kor jamn lengda p√• slaga er.")}
          ${field(c,"smash","Smash factor","Kor reint du treff ballen.",0.01)}
        </div>

        <div id="buttons-${c}"></div>
        <div id="eval-${c}"></div>
        <div class="small">‚ÑπÔ∏è Referansar basert p√• gode amat√∏rar og tour-data.</div>
        <div id="tip-${c}"></div>
      </div>
    </div>
  `;
  updateButtons(c);
  evaluateClub(c);
}

persist();

/* ===============================
   HJELPARAR
=============================== */

function persist(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
}
function hasData(v){
  return v && (v.side!=null || v.cons!=null || v.smash!=null);
}
function compareMetric(c,p,low=true){
  if(c==null||p==null) return "";
  if(low) return c<p?"‚Üë":c>p?"‚Üì":"‚Üí";
  return c>p?"‚Üë":c<p?"‚Üì":"‚Üí";
}

/* ===============================
   UI / INPUT
=============================== */

function toggle(c){
  const el=document.getElementById("content-"+c);
  const ic=document.getElementById("icon-"+c);
  el.style.display = el.style.display==="block"?"none":"block";
  ic.textContent = el.style.display==="block"?"‚ñº":"‚ñ∂";
}
function field(c,k,l,h,s=1){
  const v=clubStates[c].current[k]??"";
  return `<div class="field">
    <label>${l}</label>
    <div class="hint">${h}</div>
    <input type="number" step="${s}" value="${v}"
      oninput="setValue('${c}','${k}',this.value)">
  </div>`;
}
function setValue(c,k,v){
  clubStates[c].current[k]=v?parseFloat(v):undefined;
  persist();
  evaluateClub(c);
}

/* ===============================
   BASELINE / √òKT
=============================== */

function setBaseline(c){
  if(!hasData(clubStates[c].current)) return;
  clubStates[c].baseline = {...clubStates[c].current};
  persist();
  updateButtons(c);
  evaluateClub(c);
}
function clearBaseline(c){
  if(!confirm("Slette baseline for "+c+"?")) return;
  clubStates[c].baseline=null;
  persist();
  updateButtons(c);
  evaluateClub(c);
}
function saveSession(c){
  if(!hasData(clubStates[c].current)) return;
  clubStates[c].previous = {...clubStates[c].current};
  persist();
  evaluateClub(c);
}
function updateButtons(c){
  const el=document.getElementById("buttons-"+c);
  if(!clubStates[c].baseline){
    el.innerHTML = `
      <button onclick="setBaseline('${c}')">üìå Sett baseline</button>
      <div class="small">N√•r dette representerer normal prestasjon.</div>
    `;
  } else {
    el.innerHTML = `
      <span class="small">Baseline lagra</span><br>
      <button onclick="saveSession('${c}')">üíæ Lagre √∏kt</button>
      <button onclick="clearBaseline('${c}')">‚úèÔ∏è Rediger baseline</button>`;
  }
}

/* ===============================
   ANALYSE
=============================== */

function evaluateClub(c){
  const v=clubStates[c];
  const cur=v.current;
  const base=v.baseline;
  const prev=v.previous;

  if(!hasData(cur)){
    document.getElementById(`eval-${c}`).innerHTML =
      `<p class="small">Legg inn data for analyse.</p>`;
    document.getElementById(`tip-${c}`).innerHTML="";
    return;
  }

  const p=PGA[CLUB_MODEL[c]];
  let good=[], bad=[], focus="", tip="";

  if(cur.side<=p.side) good.push("God sidekontroll"); else bad.push("For stort side-til-side utslag");
  if(cur.cons<=p.cons) good.push("Stabil lengde"); else bad.push("Ustabil lengde");
  if(cur.smash>=p.smash) good.push("Reint treff"); else bad.push("Ureint treff");

  if(bad.includes("For stort side-til-side utslag")){
    focus="Presisjon"; tip="Sl√• mot faste m√•l og fokuser p√• kor ballen startar.";
  } else if(bad.includes("Ustabil lengde")){
    focus="Lengdekontroll"; tip="Sl√• korte og lange slag med same tempo.";
  } else if(bad.includes("Ureint treff")){
    focus="Treff"; tip="Fokuser p√• √• treffe midt i k√∏lleflata.";
  } else {
    focus="Vedlikehald"; tip="Behald gode rutinar.";
  }

  let prog="";
  if(base){
    prog += `<p class="progress">Mot baseline:
      Side ${compareMetric(cur.side,base.side,true)} |
      Lengde ${compareMetric(cur.cons,base.cons,true)} |
      Treff ${compareMetric(cur.smash,base.smash,false)}</p>`;
  }
  if(prev){
    prog += `<p class="progress">Sidan sist:
      Side ${compareMetric(cur.side,prev.side,true)} |
      Lengde ${compareMetric(cur.cons,prev.cons,true)} |
      Treff ${compareMetric(cur.smash,prev.smash,false)}</p>`;
  }

  document.getElementById(`eval-${c}`).innerHTML=
    `<p class="good"><strong>Bra:</strong> ${good.join(", ")}</p>
     <p class="bad"><strong>D√•rleg:</strong> ${bad.join(", ")||"‚Äî"}</p>
     ${prog}
     <p class="focus">üéØ Fokus: ${focus}</p>`;

  document.getElementById(`tip-${c}`).innerHTML=
    `<div class="tip"><strong>üõ† Treningsforslag:</strong> ${tip}</div>`;
}
</script>

</body>
</html>
