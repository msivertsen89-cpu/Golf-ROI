<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Golf ROI ‚Äì Treningsanalyse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ===============================
  Golf ROI ‚Äì v2.3-clean
  DESIGN FREEZE
================================ -->

<style>
body{
  font-family:Arial,sans-serif;
  background:#f4f6f8;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
h1{margin-top:8px}

.card{
  background:#fff;
  padding:14px;
  margin-bottom:14px;
  border-radius:8px;
}

button{
  padding:10px 14px;
  margin:4px 4px 0 0;
  cursor:pointer;
}

.accordion-header{
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}

.accordion-content{
  display:none;
  margin-top:12px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
  gap:12px;
}

.field label{font-size:13px}
.field .hint{font-size:12px;color:#777}

input[type=number],select{
  width:100%;
  padding:6px;
}

.good{color:green}
.bad{color:#c62828}
.focus{color:#ef6c00;font-weight:bold}

.club-focus{
  background:#fff8e1;
  border-left:4px solid #ffb300;
  padding:10px;
  border-radius:6px;
  margin-top:10px;
}

.tip{
  background:#f1f8e9;
  padding:10px;
  border-radius:6px;
  margin-top:8px;
}

.small{font-size:13px;color:#555}

.diff-up{color:green}
.diff-down{color:#c62828}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal{
  background:#fff;
  padding:20px;
  border-radius:8px;
  max-width:520px;
  width:100%;
}

pre{
  white-space:pre-wrap;
  word-wrap:break-word;
}
</style>
</head>

<body>

<h1>üèåÔ∏è Golf ROI ‚Äì Treningsanalyse</h1>

<div class="card">
  <button onclick="openOnboarding()">üöÄ Kom i gang</button>
  <button onclick="openProfile()">‚öôÔ∏è Profil</button>
  <button onclick="openClubs()">üèåÔ∏è K√∏ller</button>
</div>

<!-- BAG FOCUS -->
<div id="bagFocusCard" class="card" style="display:none;"></div>

<!-- CLUBS -->
<div id="clubs"></div>

<!-- MODALS -->

<div class="overlay" id="onboarding">
  <div class="modal">
    <h3>üöÄ Kom i gang</h3>
    <ol>
      <li>Vel k√∏llene du brukar</li>
      <li>Legg inn gjennomsnittstal</li>
      <li>Lagre baseline</li>
      <li>Legg til √∏kter og f√∏lg utvikling</li>
    </ol>
    <button onclick="closeOnboarding()">Lukk</button>
  </div>
</div>

<div class="overlay" id="profile">
  <div class="modal">
    <h3>‚öôÔ∏è Profil</h3>
    <label>Handicap-niv√•</label>
    <select id="hcp">
      <option>0‚Äì8</option>
      <option>9‚Äì15</option>
      <option>16‚Äì29</option>
      <option>30‚Äì54</option>
    </select>

    <label>Prim√¶rt treningsfokus</label>
    <select id="preference">
      <option>Presisjon</option>
      <option>Lengde</option>
      <option>Balanse</option>
    </select>

    <br><br>
    <button onclick="saveProfile()">üíæ Lagre</button>
    <button onclick="closeProfile()">Lukk</button>
  </div>
</div>

<div class="overlay" id="clubsModal">
  <div class="modal">
    <h3>üèåÔ∏è Vel k√∏ller</h3>
    <div id="clubCheckboxes"></div>
    <button onclick="saveClubs()">üíæ Lagre</button>
    <button onclick="closeClubs()">Lukk</button>
  </div>
</div>

<div class="overlay" id="sessionsModal">
  <div class="modal">
    <h3 id="sessionsTitle">üìö √òkter</h3>
    <div id="sessionsList"></div>
    <button onclick="closeSessions()">Lukk</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */

const STORAGE="roi_state_v2_3";
const ACTIVE="roi_active_clubs_v2_3";
const PROFILE="roi_profile_v2_3";

const ALL_CLUBS=[
 "Driver",
 "3W","5W","7W",
 "3i","4i","5i","6i","7i","8i","9i",
 "PW","50¬∞","56¬∞","60¬∞"
];

const PGA={
 wood:{side:12,cons:12,smash:1.45},
 iron:{side:9,cons:8,smash:1.32},
 wedge:{side:7,cons:6,smash:1.22}
};

/* ================= COACHING ================= */

const COACHING={
 Presisjon:"ovelser/startretning.html",
 Lengdekontroll:"ovelser/lengdekontroll.html",
 Treff:"ovelser/treffkvalitet.html",
 Vedlikehald:"ovelser/vedlikehald.html"
};

/* ================= STATE ================= */

let state=JSON.parse(localStorage.getItem(STORAGE))||{};
let active=JSON.parse(localStorage.getItem(ACTIVE))||[];

/* ================= HELPERS ================= */

function clubType(c){
 if(c==="Driver"||c.includes("W"))return"wood";
 if(c.endsWith("i"))return"iron";
 return"wedge";
}
function getActiveClubs(){
 return ALL_CLUBS.filter(c=>active.includes(c));
}

/* ================= BAG FOCUS ================= */

function calculateBagFocus(){
 let counts={Presisjon:0,Lengdekontroll:0,Treff:0};
 getActiveClubs().forEach(c=>{
  if(!state[c]||!state[c].baseline||!state[c].current)return;
  const v=state[c].current,b=state[c].baseline,p=PGA[clubType(c)];
  if(v.side>b.side)counts.Presisjon++;
  else if(v.cons>b.cons)counts.Lengdekontroll++;
  else if(v.smash<b.smash)counts.Treff++;
 });
 let top=null,max=0;
 for(const k in counts){if(counts[k]>max){max=counts[k];top=k}}
 if(!top||max<2)return null;
 return{focus:top,count:max};
}

function renderBagFocus(){
 const card=document.getElementById("bagFocusCard");
 const r=calculateBagFocus();
 if(!r){card.style.display="none";return}
 card.style.display="block";
 card.innerHTML=`
  <h3>üéØ Fokus for neste treningsbolk</h3>
  <p><strong>${r.focus}</strong></p>
  <p class="small">Basert p√• ${r.count} k√∏ller med avvik fr√• baseline</p>
 `;
}

/* ================= RENDER ================= */

const wrap=document.getElementById("clubs");

function render(){
 wrap.innerHTML="";
 const clubs=getActiveClubs();
 if(!clubs.length){
  wrap.innerHTML=`<div class="card small">Ingen k√∏ller vald.</div>`;
  return;
 }
 clubs.forEach(c=>{
  state[c] ||= {current:{},baseline:null,sessions:[]};
  wrap.innerHTML+=`
   <div class="card">
    <div class="accordion-header" onclick="toggle('${c}')">
      ${c}<span id="icon-${c}">‚ñ∂</span>
    </div>
    <div class="accordion-content" id="content-${c}">
      <div class="grid">
        ${field(c,"side","Side-consistency")}
        ${field(c,"cons","Length consistency")}
        ${field(c,"smash","Smash factor",0.01)}
      </div>
      <div id="actions-${c}"></div>
      <div id="eval-${c}"></div>
    </div>
   </div>`;
  renderActions(c);
  evaluate(c);
 });
 localStorage.setItem(STORAGE,JSON.stringify(state));
 renderBagFocus();
}

function field(c,k,l,s=1){
 return`
 <div class="field">
  <label>${l}</label>
  <input type="number" step="${s}"
   value="${state[c].current[k]??""}"
   oninput="update('${c}','${k}',this.value)">
 </div>`;
}

/* ================= ACTIONS ================= */

function renderActions(c){
 const el=document.getElementById("actions-"+c);
 const club=state[c];
 if(!club.baseline){
  el.innerHTML=`<button onclick="setBaseline('${c}')">üìå Lagre baseline</button>`;
 }else{
  el.innerHTML=`
   <button onclick="addSession('${c}')">‚ûï Legg til √∏kt</button>
   <button onclick="openSessions('${c}')">üìö √òkter (${club.sessions.length})</button>
   <button onclick="editBaseline('${c}')">‚úèÔ∏è Rediger baseline</button>`;
 }
}

function update(c,k,v){
 state[c].current[k]=v?parseFloat(v):undefined;
 localStorage.setItem(STORAGE,JSON.stringify(state));
 evaluate(c);
 renderBagFocus();
}

function setBaseline(c){
 state[c].baseline={...state[c].current};
 localStorage.setItem(STORAGE,JSON.stringify(state));
 renderActions(c);
}

function addSession(c){
 const club=state[c];
 club.sessions.push({
  date:new Date().toISOString().slice(0,10),
  data:{...club.current}
 });
 club.current={};
 localStorage.setItem(STORAGE,JSON.stringify(state));
 render();
}

function editBaseline(c){
 if(confirm("Slette baseline?")){
  state[c].baseline=null;
  localStorage.setItem(STORAGE,JSON.stringify(state));
  render();
 }
}

/* ================= ANALYSE ================= */

function evaluate(c){
 const v=state[c].current,p=PGA[clubType(c)];
 let good=[],bad=[],focus="Vedlikehald";

 if(v.side!=null)(v.side<=p.side?good:bad).push("Side");
 if(v.cons!=null)(v.cons<=p.cons?good:bad).push("Lengde");
 if(v.smash!=null)(v.smash>=p.smash?good:bad).push("Treff");

 if(bad.includes("Side"))focus="Presisjon";
 else if(bad.includes("Lengde"))focus="Lengdekontroll";
 else if(bad.includes("Treff"))focus="Treff";

 document.getElementById("eval-"+c).innerHTML=`
  <p class="good"><strong>Bra:</strong> ${good.join(", ")||"‚Äî"}</p>
  <p class="bad"><strong>D√•rleg:</strong> ${bad.join(", ")||"‚Äî"}</p>
  <p class="focus">üéØ Fokus: ${focus}</p>
  <div class="club-focus">
    <strong>Treningsfokus</strong>
    <em>${focus}</em><br>
    <a href="${COACHING[focus]}" target="_blank">Opne √∏ving</a>
  </div>`;
}

/* ================= MODALS ================= */

function toggle(c){
 const el=document.getElementById("content-"+c);
 const ic=document.getElementById("icon-"+c);
 el.style.display=el.style.display==="block"?"none":"block";
 ic.textContent=el.style.display==="block"?"‚ñº":"‚ñ∂";
}
function openOnboarding(){onboarding.style.display="flex"}
function closeOnboarding(){onboarding.style.display="none"}
function openProfile(){profile.style.display="flex"}
function closeProfile(){profile.style.display="none"}
function openClubs(){
 clubsModal.style.display="flex";
 clubCheckboxes.innerHTML="";
 ALL_CLUBS.forEach(c=>{
  clubCheckboxes.innerHTML+=`
   <label><input type="checkbox"
    ${active.includes(c)?"checked":""}
    onchange="toggleClub('${c}')"> ${c}</label>`;
 });
}
function closeClubs(){clubsModal.style.display="none"}
function toggleClub(c){
 active=active.includes(c)?active.filter(x=>x!==c):[...active,c];
}
function saveClubs(){
 localStorage.setItem(ACTIVE,JSON.stringify(active));
 closeClubs();render();
}
function openSessions(c){
 sessionsModal.style.display="flex";
 sessionsTitle.textContent=`üìö √òkter ‚Äì ${c}`;
 sessionsList.innerHTML=state[c].sessions.map(
  (s,i)=>`<div class="small">√òkt ${i+1} ‚Äì ${s.date}</div>`
 ).join("");
}
function closeSessions(){sessionsModal.style.display="none"}
function saveProfile(){
 localStorage.setItem(PROFILE,JSON.stringify({
  hcp:hcp.value,preference:preference.value
 }));
 closeProfile();
}

/* INIT */
render();
</script>

</body>
</html>
