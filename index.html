<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Golf ROI ‚Äì Treningsanalyse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
h1 { margin-top:20px; }
.card {
  background:white;
  padding:14px;
  margin-bottom:12px;
  border-radius:8px;
}
.accordion-header {
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.accordion-content {
  display:none;
  margin-top:12px;
}
.grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(170px,1fr));
  gap:12px;
}
.field label {
  font-size:13px;
  color:#333;
}
.field .hint {
  font-size:12px;
  color:#777;
}
input[type=number], select {
  width:100%;
  padding:6px;
}
.good { color:green; }
.bad { color:#c62828; }
.focus { color:#ef6c00; font-weight:bold; }
.tip {
  background:#f1f8e9;
  padding:10px;
  border-radius:6px;
  margin-top:8px;
}
button {
  padding:6px 10px;
  cursor:pointer;
  margin:4px 4px 0 0;
}
.small { font-size:13px; color:#555; }

.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal {
  background:white;
  padding:20px;
  border-radius:8px;
  max-width:500px;
  width:100%;
  max-height:90vh;
  overflow:auto;
}
.club-list label {
  display:block;
  margin-bottom:6px;
}
</style>
</head>

<body>

<!-- ================= ONBOARDING ================= -->
<div id="onboarding" class="overlay" style="display:none;">
  <div class="modal">
    <h2 id="onboardTitle"></h2>
    <p id="onboardText"></p>
    <button onclick="nextOnboard()">Neste</button>
  </div>
</div>

<!-- ================= PROFIL ================= -->
<div id="profileModal" class="overlay" style="display:none;">
  <div class="modal">
    <h2>Profil</h2>

    <label>Handicap</label>
    <select id="hcpInput">
      <option value="">Vel</option>
      <option>0‚Äì9</option>
      <option>10‚Äì19</option>
      <option>20‚Äì29</option>
      <option>30‚Äì54</option>
    </select>

    <br><br>

    <label>Kva √∏nskjer du √• prioritere i treninga?</label>
    <select id="goalInput">
      <option value="">Vel</option>
      <option>Presisjon</option>
      <option>Lengde</option>
      <option>Stabilitet</option>
    </select>
    <p class="small">Brukast n√•r fleire omr√•de er like svake.</p>

    <button onclick="saveProfile()">Lagre</button>
  </div>
</div>

<!-- ================= VEL K√òLLER (f√∏rste gong) ================= -->
<div id="clubSelectModal" class="overlay" style="display:none;">
  <div class="modal">
    <h2>üèåÔ∏è Kva k√∏ller har du i bagen?</h2>
    <p class="small">Vel dei k√∏llene du faktisk brukar. Du kan endre dette seinare.</p>
    <div class="club-list" id="clubCheckboxes"></div>
    <button onclick="saveActiveClubs()">Lagre og start</button>
  </div>
</div>

<!-- ================= ADMINISTRER K√òLLER ================= -->
<div id="manageClubsModal" class="overlay" style="display:none;">
  <div class="modal">
    <h2>‚öôÔ∏è Administrer k√∏ller</h2>
    <div class="club-list" id="manageClubCheckboxes"></div>
    <button onclick="saveActiveClubs(true)">Lagre</button>
  </div>
</div>

<h1>üèåÔ∏è Golf ROI ‚Äì Treningsanalyse</h1>

<div class="card">
  <button onclick="startOnboarding()">‚ÑπÔ∏è Kom i gang</button>
  <button onclick="openProfile()">‚öôÔ∏è Profil</button>
  <button onclick="openManageClubs()">üèåÔ∏è K√∏ller</button>
</div>

<div id="clubs"></div>

<script>
/* ================= KONFIG ================= */

const STORAGE_KEY = "roi_state_v1_4_1";
const ACTIVE_KEY = "roi_active_clubs_v1_4_1";
const PROFILE_KEY = "roi_profile_v1_4_1";
const ONBOARD_KEY = "roi_onboarded_v1";

const CLUBS = [
  "Driver","3W","5W","7W",
  "2H","3H","4H","5H",
  "3i","4i","5i","6i","7i","8i","9i",
  "PW","50¬∞","54‚Äì56¬∞","58‚Äì60¬∞"
];

const PGA = {
  wood:{ side:12, cons:12, smash:1.45 },
  hybrid:{ side:10, cons:10, smash:1.38 },
  iron:{ side:9, cons:8, smash:1.32 },
  wedge:{ side:7, cons:6, smash:1.25 }
};

function clubType(id){
  if(id.includes("W") || id==="Driver") return "wood";
  if(id.includes("H")) return "hybrid";
  if(id.includes("i")) return "iron";
  return "wedge";
}

/* ================= STATE ================= */

let clubStates = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let activeClubs = JSON.parse(localStorage.getItem(ACTIVE_KEY)) || null;
let profile = JSON.parse(localStorage.getItem(PROFILE_KEY)) || {};

/* ================= ONBOARDING ================= */

const onboardSteps = [
  {t:"Dette er ein trenar", d:"Appen gir konkrete treningsr√•d per k√∏lle ‚Äì ikkje berre tal."},
  {t:"Dette treng du", d:"Legg inn grove snitt. Start med 2‚Äì3 k√∏ller ‚Äì det er meir enn godt nok."},
  {t:"Dette f√•r du", d:"Du f√•r fokus og √∏vingar som gjer treninga meir m√•lretta."}
];
let onboardIndex = 0;

if(!localStorage.getItem(ONBOARD_KEY)){
  startOnboarding();
} else if(!activeClubs){
  openClubSelect();
} else {
  render();
}

function startOnboarding(){
  onboardIndex = 0;
  document.getElementById("onboarding").style.display="flex";
  renderOnboard();
}
function nextOnboard(){
  onboardIndex++;
  if(onboardIndex>=onboardSteps.length){
    document.getElementById("onboarding").style.display="none";
    localStorage.setItem(ONBOARD_KEY,"true");
    if(!activeClubs) openClubSelect();
    return;
  }
  renderOnboard();
}
function renderOnboard(){
  document.getElementById("onboardTitle").innerText = onboardSteps[onboardIndex].t;
  document.getElementById("onboardText").innerText = onboardSteps[onboardIndex].d;
}

/* ================= PROFIL ================= */

function openProfile(){
  document.getElementById("hcpInput").value = profile.hcp || "";
  document.getElementById("goalInput").value = profile.goal || "";
  document.getElementById("profileModal").style.display="flex";
}
function saveProfile(){
  profile.hcp = document.getElementById("hcpInput").value;
  profile.goal = document.getElementById("goalInput").value;
  localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));
  document.getElementById("profileModal").style.display="none";
}

/* ================= K√òLLER ================= */

function openClubSelect(manage=false){
  const modal = manage?"manageClubsModal":"clubSelectModal";
  const box = manage?"manageClubCheckboxes":"clubCheckboxes";
  document.getElementById(modal).style.display="flex";
  const el = document.getElementById(box);
  el.innerHTML="";
  CLUBS.forEach(c=>{
    const checked = activeClubs?.includes(c)?"checked":"";
    el.innerHTML += `<label><input type="checkbox" value="${c}" ${checked}> ${c}</label>`;
  });
}

function saveActiveClubs(manage=false){
  const modal = manage?"manageClubsModal":"clubSelectModal";
  const inputs = document.querySelectorAll(`#${modal} input:checked`);
  activeClubs = [...inputs].map(i=>i.value);
  localStorage.setItem(ACTIVE_KEY, JSON.stringify(activeClubs));
  document.getElementById(modal).style.display="none";
  render();
}

function openManageClubs(){ openClubSelect(true); }

/* ================= RENDER & ANALYSE ================= */

function render(){
  const container=document.getElementById("clubs");
  container.innerHTML="";
  activeClubs.forEach(id=>{
    clubStates[id] ||= {baseline:null, previous:null, current:{}};
    const type=clubType(id);
    const p=PGA[type];
    const v=clubStates[id].current;

    container.innerHTML+=`
      <div class="card">
        <div class="accordion-header" onclick="toggle('${id}')">
          ${id}<span id="icon-${id}">‚ñ∂</span>
        </div>
        <div class="accordion-content" id="content-${id}">
          <div class="grid">
            ${input(id,"side","Side-consistency (m)","Side-til-side utslag")}
            ${input(id,"cons","Length consistency (m)","Kor jamn lengda er")}
            ${input(id,"smash","Smash factor","Kor reint du treff",0.01)}
          </div>
          <div id="eval-${id}"></div>
        </div>
      </div>`;
    evaluate(id,p);
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
}

function toggle(id){
  const el=document.getElementById("content-"+id);
  const ic=document.getElementById("icon-"+id);
  el.style.display=el.style.display==="block"?"none":"block";
  ic.textContent=el.style.display==="block"?"‚ñº":"‚ñ∂";
}

function input(id,k,l,h,s=1){
  const v=clubStates[id].current[k]??"";
  return `<div class="field">
    <label>${l}</label><div class="hint">${h}</div>
    <input type="number" step="${s}" value="${v}"
      oninput="clubStates['${id}'].current['${k}']=parseFloat(this.value); render()">
  </div>`;
}

function evaluate(id,p){
  const v=clubStates[id].current;
  const el=document.getElementById("eval-"+id);
  if(!v.side&&!v.cons&&!v.smash){
    el.innerHTML="<p class='small'>Legg inn data.</p>"; return;
  }
  let good=[],bad=[];
  if(v.side<=p.side) good.push("God sidekontroll"); else bad.push("For stort sideutslag");
  if(v.cons<=p.cons) good.push("Stabil lengde"); else bad.push("Ustabil lengde");
  if(v.smash>=p.smash) good.push("Reint treff"); else bad.push("Ureint treff");
  el.innerHTML=`
    <p class="good"><strong>Bra:</strong> ${good.join(", ")}</p>
    <p class="bad"><strong>D√•rleg:</strong> ${bad.join(", ")||"‚Äî"}</p>`;
}
</script>

</body>
</html>
