<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Golf ROI ‚Äì Treningsanalyse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
h1 { margin-top:20px; }
.card {
  background:white;
  padding:14px;
  margin-bottom:12px;
  border-radius:8px;
}
.accordion-header {
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.accordion-content {
  display:none;
  margin-top:12px;
}
.grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(170px,1fr));
  gap:12px;
}
.field label { font-size:13px; }
.field .hint { font-size:12px; color:#777; }
input[type=number], select {
  width:100%;
  padding:6px;
}
.good { color:green; }
.bad { color:#c62828; }
.focus { color:#ef6c00; font-weight:bold; }
.tip {
  background:#f1f8e9;
  padding:10px;
  border-radius:6px;
  margin-top:8px;
}
button {
  padding:6px 10px;
  cursor:pointer;
  margin:4px 4px 0 0;
}
.small { font-size:13px; color:#555; }
a { color:#1565c0; font-weight:bold; text-decoration:none; }

.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal {
  background:white;
  padding:20px;
  border-radius:8px;
  max-width:500px;
  width:100%;
  max-height:90vh;
  overflow:auto;
}
.club-list label { display:block; margin-bottom:6px; }
</style>
</head>

<body>

<h1>üèåÔ∏è Golf ROI ‚Äì Treningsanalyse</h1>

<div class="card">
  <button onclick="openProfile()">‚öôÔ∏è Profil</button>
  <button onclick="openManageClubs()">üèåÔ∏è K√∏ller</button>
</div>

<div id="clubs"></div>

<script>
/* ================= KONFIG ================= */

const STORAGE_KEY = "roi_state_v1_4_6";
const ACTIVE_KEY  = "roi_active_clubs_v1_4_6";
const PROFILE_KEY = "roi_profile_v1_4_6";

const CLUBS = [
  "Driver","3W","5W","7W",
  "2H","3H","4H","5H",
  "3i","4i","5i","6i","7i","8i","9i",
  "PW","50¬∞","54‚Äì56¬∞","58‚Äì60¬∞"
];

const PGA = {
  wood:{ side:12, cons:12 },
  hybrid:{ side:10, cons:10 },
  iron:{ side:9, cons:8 },
  wedge:{ side:7, cons:6 }
};

const SMASH_TARGET = {
  wood:1.45, hybrid:1.38, iron:1.32, wedge:1.22
};

function clubType(id){
  if(id==="Driver"||["3W","5W","7W"].includes(id)) return "wood";
  if(["2H","3H","4H","5H"].includes(id)) return "hybrid";
  if(id.endsWith("i")) return "iron";
  return "wedge";
}

/* ================= STATE ================= */

let clubStates = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let activeClubs = JSON.parse(localStorage.getItem(ACTIVE_KEY)) || CLUBS;
let profile = JSON.parse(localStorage.getItem(PROFILE_KEY)) || {};

/* ================= RENDER ================= */

const container = document.getElementById("clubs");
render();

function render(){
  container.innerHTML="";
  activeClubs.forEach(id=>{
    clubStates[id] ||= { baseline:null, previous:null, current:{} };

    container.innerHTML+=`
      <div class="card">
        <div class="accordion-header" onclick="toggle('${id}')">
          ${id}<span id="icon-${id}">‚ñ∂</span>
        </div>
        <div class="accordion-content" id="content-${id}">
          <div class="grid">
            ${input(id,"side","Side-consistency (m)","Side-til-side utslag")}
            ${input(id,"cons","Length consistency (m)","Lengdespredning")}
            ${input(id,"smash","Smash factor","Treffkvalitet",0.01)}
          </div>

          <div id="save-${id}"></div>
          <div id="eval-${id}"></div>
        </div>
      </div>
    `;
    evaluate(id);
    renderSaveButtons(id);
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
}

function toggle(id){
  const el=document.getElementById("content-"+id);
  const ic=document.getElementById("icon-"+id);
  el.style.display=el.style.display==="block"?"none":"block";
  ic.textContent=el.style.display==="block"?"‚ñº":"‚ñ∂";
}

function input(id,key,label,hint,step=1){
  const v=clubStates[id].current[key] ?? "";
  return `
  <div class="field">
    <label>${label}</label>
    <div class="hint">${hint}</div>
    <input type="number" step="${step}" value="${v}"
      oninput="updateValue('${id}','${key}',this.value)">
  </div>`;
}

function updateValue(id,key,value){
  clubStates[id].current[key]=value?parseFloat(value):undefined;
  localStorage.setItem(STORAGE_KEY,JSON.stringify(clubStates));
  evaluate(id);
}

/* ================= LAGRING ================= */

function renderSaveButtons(id){
  const el = document.getElementById("save-"+id);
  const s = clubStates[id];

  if(!s.baseline){
    el.innerHTML = `
      <button onclick="setBaseline('${id}')">üìå Lagre baseline</button>
      <p class="small">
        Bruk n√•r dette representerer normal prestasjon for denne k√∏lla.
      </p>
    `;
  } else {
    el.innerHTML = `
      <p class="small">Baseline lagra ‚úÖ</p>
      <button onclick="saveSession('${id}')">üíæ Lagre √∏kt</button>
      <button onclick="editBaseline('${id}')">‚úèÔ∏è Rediger baseline</button>
    `;
  }
}

function setBaseline(id){
  clubStates[id].baseline={...clubStates[id].current};
  localStorage.setItem(STORAGE_KEY,JSON.stringify(clubStates));
  renderSaveButtons(id);
}

function saveSession(id){
  clubStates[id].previous={...clubStates[id].current};
  localStorage.setItem(STORAGE_KEY,JSON.stringify(clubStates));
}

function editBaseline(id){
  if(confirm("Slette baseline for "+id+"?")){
    clubStates[id].baseline=null;
    localStorage.setItem(STORAGE_KEY,JSON.stringify(clubStates));
    renderSaveButtons(id);
  }
}

/* ================= ANALYSE ================= */

function getDrillLink(focus){
  if(focus==="Presisjon") return "ovelser/startretning.html";
  if(focus==="Lengdekontroll") return "ovelser/lengde.html";
  if(focus==="Treff") return "ovelser/treff.html";
  return "ovelser/vedlikehold.html";
}

function evaluate(id){
  const v=clubStates[id].current;
  const type=clubType(id);
  const p=PGA[type];
  const smashT=SMASH_TARGET[type];
  const el=document.getElementById("eval-"+id);

  let good=[],bad=[],focus="",tip="";

  if(v.side!=null){
    v.side<=p.side?good.push("God sidekontroll"):bad.push("For stort sideutslag");
  }
  if(v.cons!=null){
    v.cons<=p.cons?good.push("Stabil lengde"):bad.push("Ustabil lengde");
  }
  if(v.smash!=null){
    v.smash>=smashT?good.push("Reint treff"):bad.push("Ureint treff");
  }

  if(!good.length&&!bad.length){
    el.innerHTML="<p class='small'>Legg inn data for analyse.</p>";
    return;
  }

  if(bad.includes("For stort sideutslag")){
    focus="Presisjon"; tip="Jobb med startretning.";
  } else if(bad.includes("Ustabil lengde")){
    focus="Lengdekontroll"; tip="Jobb med tempo og lengde.";
  } else if(bad.includes("Ureint treff")){
    focus="Treff"; tip="Fokus p√• senterkontakt.";
  } else {
    focus="Vedlikehald"; tip="Behald gode rutinar.";
  }

  el.innerHTML=`
    <p class="good"><strong>Bra:</strong> ${good.join(", ")||"‚Äî"}</p>
    <p class="bad"><strong>D√•rleg:</strong> ${bad.join(", ")||"‚Äî"}</p>
    <p class="focus">üéØ Fokus: ${focus}</p>
    <div class="tip">
      <strong>üõ† Treningsforslag:</strong> ${tip}<br>
      <a href="${getDrillLink(focus)}" target="_blank">üëâ Opne √∏ving</a>
    </div>`;
}

/* ================= PROFIL & K√òLLER ================= */

function openProfile(){
  alert("Profil kan utvidast vidare seinare.");
}
function openManageClubs(){
  alert("K√∏lleadministrasjon kan utvidast vidare seinare.");
}
</script>

</body>
</html>
