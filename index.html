<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Golf ROI ‚Äì 12 ukers analyse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
h1 { margin-top:20px; }
.card {
  background:white;
  padding:14px;
  margin-bottom:12px;
  border-radius:8px;
}
.accordion-header {
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.accordion-content {
  display:none;
  margin-top:12px;
}
.grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}
.field label {
  font-size:13px;
  color:#555;
}
input[type=number], select {
  width:100%;
  padding:6px;
}
.good { color:green; }
.bad { color:#c62828; }
.focus { color:#ef6c00; font-weight:bold; }
.diff-good { color:green; }
.diff-bad { color:#c62828; }
button {
  padding:8px 14px;
  cursor:pointer;
}
.small { font-size:13px; color:#555; }
hr { margin:16px 0; }
.top-row {
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
}
</style>
</head>

<body>

<h1>üèåÔ∏è Golf ROI ‚Äì 12 ukers analyse</h1>

<!-- TOPPANEL -->
<div class="card">
  <div class="top-row">
    <button onclick="saveBaseline()">üìå Lagre baseline (uke 0)</button>
    <button onclick="toggleBaseline()">üëÅÔ∏è Vis / skjul baseline</button>
    <button onclick="window.open('pdf/ukeprogram.pdf','_blank')">üìÖ Ukeprogram</button>
    <button onclick="window.open('pdf/12ukers_program.pdf','_blank')">üìà 12-ukers program</button>
    <button onclick="window.location.href='treningslogg.html'">üìù Treningslogg</button>

    <select id="blockSelect" onchange="evaluateBlockFocus()">
      <option value="1">Bolk 1 (uke 1‚Äì4)</option>
      <option value="2">Bolk 2 (uke 5‚Äì8)</option>
      <option value="3">Bolk 3 (uke 9‚Äì12)</option>
    </select>
  </div>
  <p id="baselineInfo" class="small"></p>
</div>

<!-- BOLK-FOKUS -->
<div class="card">
  <h3>üéØ Fokus for neste bolk</h3>
  <p id="blockFocusText" class="small">Legg inn data for √• f√• tilbakemelding.</p>
</div>

<!-- K√òLLER -->
<div id="clubs"></div>

<!-- BAG -->
<div class="card">
  <h3>üìä Bag-oppsummering</h3>
  <p id="bagHcp"></p>
  <p class="small">
    Bag-hcp er ein modellbasert indikator. Presisjonen aukar n√•r fleire k√∏ller er registrert.
  </p>
</div>

<script>
/* ===============================
   KONFIG
=============================== */

const STORAGE_KEY = "roi_current_v2";
const BASELINE_KEY = "roi_baseline_v2";

const CLUB_MODEL = {
  "Driver": { type:"wood", w:1.2 },
  "5W": { type:"wood", w:1.0 },
  "5i": { type:"iron", w:1.0 },
  "6i": { type:"iron", w:1.0 },
  "7i": { type:"iron", w:1.0 },
  "8i": { type:"iron", w:1.0 },
  "9i": { type:"iron", w:1.0 },
  "PW": { type:"wedge", w:0.9 },
  "50¬∞": { type:"wedge", w:0.9 },
  "56¬∞": { type:"wedge", w:0.9 },
  "60¬∞": { type:"wedge", w:0.9 }
};

const PGA = {
  wood:{ side:12, cons:12, smash:1.45 },
  iron:{ side:9, cons:8, smash:1.32 },
  wedge:{ side:7, cons:6, smash:1.25 }
};

const DIFF_RULE = { side:"lower", cons:"lower", carry:"higher" };

/* ===============================
   STATE
=============================== */

let clubStates = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let baselineStates = JSON.parse(localStorage.getItem(BASELINE_KEY)) || null;
let showBaseline = true;

/* ===============================
   INIT UI
=============================== */

const container = document.getElementById("clubs");

for(const club in CLUB_MODEL){
  clubStates[club] ||= {};
  container.innerHTML += `
    <div class="card">
      <div class="accordion-header" onclick="toggle('${club}')">
        ${club}<span id="icon-${club}">‚ñ∂</span>
      </div>
      <div class="accordion-content" id="content-${club}">
        <div class="grid">
          ${field(club,"carry","Carry (m)")}
          ${field(club,"side","Side dispersion (m)")}
          ${field(club,"cons","Length consistency (m)")}
          ${field(club,"launch","Launch angle (¬∞)")}
          ${field(club,"spin","Spin rate (rpm)")}
          ${field(club,"aoa","Attack angle (¬∞)")}
          ${field(club,"smash","Smash factor",0.01)}
        </div>
        <div id="eval-${club}"></div>
        <div id="diff-${club}"></div>
      </div>
    </div>`;
  evaluateClub(club);
  showDiff(club);
}

evaluateBag();
updateBaselineInfo();
evaluateBlockFocus();

/* ===============================
   FUNKSJONAR
=============================== */

function toggle(club){
  const el=document.getElementById("content-"+club);
  const icon=document.getElementById("icon-"+club);
  el.style.display = el.style.display==="block"?"none":"block";
  icon.textContent = el.style.display==="block"?"‚ñº":"‚ñ∂";
}

function field(club,key,label,step=1){
  const v=clubStates[club][key]??"";
  return `<div class="field"><label>${label}</label>
  <input type="number" step="${step}" value="${v}"
  oninput="setValue('${club}','${key}',this.value)"></div>`;
}

function setValue(c,k,v){
  clubStates[c][k]=v?parseFloat(v):undefined;
  localStorage.setItem(STORAGE_KEY,JSON.stringify(clubStates));
  evaluateClub(c); showDiff(c); evaluateBag(); evaluateBlockFocus();
}

function saveBaseline(){
  baselineStates=JSON.parse(JSON.stringify(clubStates));
  localStorage.setItem(BASELINE_KEY,JSON.stringify(baselineStates));
  updateBaselineInfo();
  for(const c in CLUB_MODEL) showDiff(c);
}

function toggleBaseline(){
  showBaseline=!showBaseline;
  for(const c in CLUB_MODEL) showDiff(c);
}

function updateBaselineInfo(){
  document.getElementById("baselineInfo").innerText =
    baselineStates?"Baseline lagra ‚úÖ":"Ingen baseline lagra.";
}

/* ===============================
   ANALYSE PER K√òLLE
=============================== */

function evaluateClub(c){
  const v=clubStates[c], p=PGA[CLUB_MODEL[c].type];
  let good=[], bad=[];
  if(v.side!=null) v.side<=p.side?good.push("God sidepresisjon"):bad.push("For stor side-spredning");
  if(v.cons!=null) v.cons<=p.cons?good.push("Stabil lengde"):bad.push("Ustabil lengde");
  if(v.smash!=null) v.smash>=p.smash?good.push("God treffkvalitet"):bad.push("Lav smash");
  let f=bad.includes("For stor side-spredning")?"Presisjon":
        bad.includes("Ustabil lengde")?"Lengdekontroll":
        bad.length?"Treff":"Vedlikehald";
  document.getElementById(`eval-${c}`).innerHTML=
   `<p class="good"><strong>Bra:</strong> ${good.join(", ")||"‚Äî"}</p>
    <p class="bad"><strong>D√•rleg:</strong> ${bad.join(", ")||"‚Äî"}</p>
    <p class="focus">üéØ Fokus: ${f}</p>`;
}

/* ===============================
   BASELINE-DIFF
=============================== */

function showDiff(c){
  const d=document.getElementById(`diff-${c}`);
  if(!baselineStates||!baselineStates[c]||!showBaseline){ d.innerHTML=""; return; }
  let rows=[];
  ["side","cons","carry"].forEach(k=>{
    if(clubStates[c][k]!=null && baselineStates[c][k]!=null){
      const diff=clubStates[c][k]-baselineStates[c][k];
      const good=(DIFF_RULE[k]==="lower"&&diff<=0)||(DIFF_RULE[k]==="higher"&&diff>=0);
      rows.push(`<div class="${good?"diff-good":"diff-bad"}">${k}: ${baselineStates[c][k]} ‚Üí ${clubStates[c][k]} (${diff>0?"+":""}${diff.toFixed(1)})</div>`);
    }
  });
  d.innerHTML=rows.length?`<hr><strong>Endring sidan baseline:</strong>${rows.join("")}`:"";
}

/* ===============================
   BLOK-FOKUS
=============================== */

const blockTexts={
 "1":{
  "Presisjon":"Data viser for stor side-spredning. Prioriter presisjon og stabil startretning i denne bolken.",
  "Lengdekontroll":"Lengdevariasjon er hovudutfordring. Tren kontroll i roleg tempo.",
  "Treff":"Treffkvalitet b√∏r prioriterast f√∏r tempo.",
  "Vedlikehald":"Data er balanserte. Hald ved like ferdigheitene."
 },
 "2":{
  "Presisjon":"Presisjon b√∏r testast etter tempo og lengde√∏vingar.",
  "Lengdekontroll":"Lengdekontroll b√∏r trenast under st√∏rre belastning.",
  "Treff":"Test stabil utf√∏ring i varierande tempo.",
  "Vedlikehald":"Vidaref√∏r strukturert trening."
 },
 "3":{
  "Presisjon":"Presisjon b√∏r trenast i konkurranseliknande situasjonar.",
  "Lengdekontroll":"Lengdekontroll b√∏r automatiserast under press.",
  "Treff":"Fokus p√• robustheit ‚Äì eitt slag, eitt m√•l.",
  "Vedlikehald":"Avsluttande vedlikehald og automatisering."
 }
};

function evaluateBlockFocus(){
  let p=0,l=0,s=0;
  for(const c in CLUB_MODEL){
    const v=clubStates[c], pg=PGA[CLUB_MODEL[c].type];
    if(!v) continue;
    if(v.side!=null&&v.side>pg.side) p++;
    if(v.cons!=null&&v.cons>pg.cons) l++;
    if(v.smash!=null&&v.smash<pg.smash) s++;
  }
  let focus=p>=2?"Presisjon":l>=2?"Lengdekontroll":s>=2?"Treff":"Vedlikehald";
  const block=document.getElementById("blockSelect").value;
  document.getElementById("blockFocusText").innerText=blockTexts[block][focus];
}

/* ===============================
   BAG-HCP
=============================== */

function estimateHcp(c){
  const v=clubStates[c], pg=PGA[CLUB_MODEL[c].type];
  let s=0;
  if(v.side!=null&&v.side>pg.side) s++;
  if(v.cons!=null&&v.cons>pg.cons) s++;
  return 8+s*3;
}

function evaluateBag(){
  let sum=0,w=0,max=0;
  for(const c in CLUB_MODEL){
    if(Object.keys(clubStates[c]).length){
      const h=estimateHcp(c);
      sum+=h*CLUB_MODEL[c].w; w+=CLUB_MODEL[c].w;
      if(h>max) max=h;
    }
  }
  if(!w){ document.getElementById("bagHcp").innerText="Legg inn data."; return; }
  const avg=sum/w, bag=avg+0.5*(max-avg);
  document.getElementById("bagHcp").innerHTML=`<strong>Estimert bag-hcp:</strong> ${bag.toFixed(1)}`;
}
</script>

</body>
</html>
