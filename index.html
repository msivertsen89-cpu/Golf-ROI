<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Golf ROI ‚Äì Treningsanalyse</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:16px;
  max-width:1000px;
  margin:auto;
}
h1 { margin-top:20px; }
.card {
  background:white;
  padding:14px;
  margin-bottom:12px;
  border-radius:8px;
}
.accordion-header {
  font-weight:bold;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
}
.accordion-content {
  display:none;
  margin-top:12px;
}
.grid {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(170px,1fr));
  gap:12px;
}
.field label {
  font-size:13px;
  color:#333;
}
.field .hint {
  font-size:12px;
  color:#777;
}
input[type=number], select {
  width:100%;
  padding:6px;
}
.good { color:green; }
.bad { color:#c62828; }
.focus { color:#ef6c00; font-weight:bold; }
.tip {
  background:#f1f8e9;
  padding:10px;
  border-radius:6px;
  margin-top:8px;
}
.progress {
  font-size:14px;
  margin-top:6px;
}
button {
  padding:6px 10px;
  cursor:pointer;
  margin:4px 4px 0 0;
}
.small { font-size:13px; color:#555; }

.overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal {
  background:white;
  padding:20px;
  border-radius:8px;
  max-width:500px;
  width:100%;
  max-height:90vh;
  overflow:auto;
}
.modal h2 { margin-top:0; }
.club-list label {
  display:block;
  margin-bottom:6px;
}
</style>
</head>

<body>

<!-- MODAL: VEL K√òLLER -->
<div id="clubSelectModal" class="overlay" style="display:none;">
  <div class="modal">
    <h2>üèåÔ∏è Kva k√∏ller har du i bagen?</h2>
    <p class="small">Vel dei k√∏llene du faktisk brukar. Du kan endre dette seinare.</p>
    <div class="club-list" id="clubCheckboxes"></div>
    <button onclick="saveActiveClubs()">Lagre og start</button>
  </div>
</div>

<!-- MODAL: ADMINISTRER K√òLLER -->
<div id="manageClubsModal" class="overlay" style="display:none;">
  <div class="modal">
    <h2>‚öôÔ∏è Administrer k√∏ller</h2>
    <div class="club-list" id="manageClubCheckboxes"></div>
    <button onclick="saveActiveClubs(true)">Lagre</button>
  </div>
</div>

<h1>üèåÔ∏è Golf ROI ‚Äì Treningsanalyse</h1>

<div class="card">
  <button onclick="openManageClubs()">‚öôÔ∏è Administrer k√∏ller</button>
</div>

<div id="clubs"></div>

<script>
/* ===============================
   KONFIG
=============================== */

const STORAGE_KEY = "roi_state_v1_4";
const ACTIVE_KEY = "roi_active_clubs_v1_4";

const CLUBS = [
  {id:"Driver", type:"wood"},
  {id:"3W", type:"wood"},
  {id:"5W", type:"wood"},
  {id:"7W", type:"wood"},

  {id:"2H", type:"hybrid"},
  {id:"3H", type:"hybrid"},
  {id:"4H", type:"hybrid"},
  {id:"5H", type:"hybrid"},

  {id:"3i", type:"iron"},
  {id:"4i", type:"iron"},
  {id:"5i", type:"iron"},
  {id:"6i", type:"iron"},
  {id:"7i", type:"iron"},
  {id:"8i", type:"iron"},
  {id:"9i", type:"iron"},

  {id:"PW", type:"wedge"},
  {id:"50¬∞", type:"wedge"},
  {id:"54‚Äì56¬∞", type:"wedge"},
  {id:"58‚Äì60¬∞", type:"wedge"}
];

const PGA = {
  wood:{ side:12, cons:12, smash:1.45 },
  hybrid:{ side:10, cons:10, smash:1.38 },
  iron:{ side:9, cons:8, smash:1.32 },
  wedge:{ side:7, cons:6, smash:1.25 }
};

/* ===============================
   STATE
=============================== */

let clubStates = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let activeClubs = JSON.parse(localStorage.getItem(ACTIVE_KEY)) || null;

/* ===============================
   INIT
=============================== */

if(!activeClubs){
  openClubSelect(true);
} else {
  render();
}

/* ===============================
   CLUB SELECTION
=============================== */

function openClubSelect(first=false){
  document.getElementById(first?"clubSelectModal":"manageClubsModal").style.display="flex";
  const container = document.getElementById(first?"clubCheckboxes":"manageClubCheckboxes");
  container.innerHTML = "";

  CLUBS.forEach(c=>{
    const checked = activeClubs ? activeClubs.includes(c.id) : false;
    container.innerHTML += `
      <label>
        <input type="checkbox" value="${c.id}" ${checked?"checked":""}>
        ${c.id}
      </label>
    `;
  });
}

function saveActiveClubs(isManage=false){
  const modalId = isManage?"manageClubsModal":"clubSelectModal";
  const inputs = document.querySelectorAll(`#${modalId} input[type=checkbox]:checked`);
  activeClubs = Array.from(inputs).map(i=>i.value);

  localStorage.setItem(ACTIVE_KEY, JSON.stringify(activeClubs));
  document.getElementById(modalId).style.display="none";
  render();
}

function openManageClubs(){
  openClubSelect(false);
}

/* ===============================
   RENDER
=============================== */

function render(){
  const container = document.getElementById("clubs");
  container.innerHTML = "";

  activeClubs.forEach(id=>{
    const meta = CLUBS.find(c=>c.id===id);
    if(!clubStates[id]) clubStates[id] = { baseline:null, previous:null, current:{} };

    container.innerHTML += `
      <div class="card">
        <div class="accordion-header" onclick="toggle('${id}')">
          ${id}<span id="icon-${id}">‚ñ∂</span>
        </div>

        <div class="accordion-content" id="content-${id}">
          <div class="grid">
            ${field(id,"side","Side-consistency (m)","Side-til-side utslag, ca. 10‚Äì20 slag")}
            ${field(id,"cons","Length consistency (m)","Kor jamn lengda er")}
            ${field(id,"smash","Smash factor","Kor reint du treff",0.01)}
          </div>

          <div id="buttons-${id}"></div>
          <div id="eval-${id}"></div>
          <div id="tip-${id}"></div>
        </div>
      </div>
    `;

    updateButtons(id);
    evaluateClub(id, meta.type);
  });

  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
}

/* ===============================
   UI HELPERS
=============================== */

function toggle(id){
  const el=document.getElementById("content-"+id);
  const ic=document.getElementById("icon-"+id);
  el.style.display = el.style.display==="block"?"none":"block";
  ic.textContent = el.style.display==="block"?"‚ñº":"‚ñ∂";
}

function field(id,key,label,hint,step=1){
  const v=clubStates[id].current[key] ?? "";
  return `
    <div class="field">
      <label>${label}</label>
      <div class="hint">${hint}</div>
      <input type="number" step="${step}" value="${v}"
        oninput="setValue('${id}','${key}',this.value)">
    </div>`;
}

function setValue(id,key,val){
  clubStates[id].current[key]=val?parseFloat(val):undefined;
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
  evaluateClub(id, CLUBS.find(c=>c.id===id).type);
}

/* ===============================
   BASELINE / √òKT
=============================== */

function updateButtons(id){
  const el=document.getElementById("buttons-"+id);
  if(!clubStates[id].baseline){
    el.innerHTML = `
      <button onclick="setBaseline('${id}')">üìå Sett baseline</button>
      <div class="small">N√•r dette representerer normal prestasjon.</div>`;
  } else {
    el.innerHTML = `
      <span class="small">Baseline lagra</span><br>
      <button onclick="saveSession('${id}')">üíæ Lagre √∏kt</button>
      <button onclick="clearBaseline('${id}')">‚úèÔ∏è Rediger baseline</button>`;
  }
}

function setBaseline(id){
  clubStates[id].baseline = {...clubStates[id].current};
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
  updateButtons(id);
  evaluateClub(id, CLUBS.find(c=>c.id===id).type);
}

function saveSession(id){
  clubStates[id].previous = {...clubStates[id].current};
  localStorage.setItem(STORAGE_KEY, JSON.stringify(clubStates));
  evaluateClub(id, CLUBS.find(c=>c.id===id).type);
}

function clearBaseline(id){
  if(confirm("Slette baseline for "+id+"?")){
    clubStates[id].baseline=null;
    updateButtons(id);
    evaluateClub(id, CLUBS.find(c=>c.id===id).type);
  }
}

/* ===============================
   ANALYSE
=============================== */

function evaluateClub(id,type){
  const v=clubStates[id];
  const cur=v.current;
  const p=PGA[type];

  if(!cur.side && !cur.cons && !cur.smash){
    document.getElementById(`eval-${id}`).innerHTML =
      `<p class="small">Legg inn data for analyse.</p>`;
    document.getElementById(`tip-${id}`).innerHTML="";
    return;
  }

  let good=[], bad=[], focus="", tip="";

  if(cur.side<=p.side) good.push("God sidekontroll"); else bad.push("For stort side-til-side utslag");
  if(cur.cons<=p.cons) good.push("Stabil lengde"); else bad.push("Ustabil lengde");
  if(cur.smash>=p.smash) good.push("Reint treff"); else bad.push("Ureint treff");

  if(bad.includes("For stort side-til-side utslag")){
    focus="Presisjon"; tip="Sl√• mot faste m√•l og sj√• kvar ballen startar.";
  } else if(bad.includes("Ustabil lengde")){
    focus="Lengdekontroll"; tip="Vari√©r lengde, same tempo.";
  } else if(bad.includes("Ureint treff")){
    focus="Treff"; tip="Fokuser p√• √• treffe midt i k√∏lleflata.";
  } else {
    focus="Vedlikehald"; tip="Behald gode rutinar.";
  }

  document.getElementById(`eval-${id}`).innerHTML = `
    <p class="good"><strong>Bra:</strong> ${good.join(", ")}</p>
    <p class="bad"><strong>D√•rleg:</strong> ${bad.join(", ")||"‚Äî"}</p>
    <p class="focus">üéØ Fokus: ${focus}</p>`;

  document.getElementById(`tip-${id}`).innerHTML =
    `<div class="tip"><strong>üõ† Treningsforslag:</strong> ${tip}</div>`;
}
</script>

</body>
</html>
